<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kompite - Econom√≠a de Habilidad</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- ================================================================== -->
    <!-- LOADER INICIAL -->
    <!-- ================================================================== -->
    <div id="loader" class="loader">
        <div class="loader-content">
            <div class="loader-logo">
                <span class="logo-k">K</span>
                <span class="logo-text">OMPITE</span>
            </div>
            <div class="loader-bar">
                <div class="loader-progress"></div>
            </div>
            <p class="loader-text">Conectando...</p>
        </div>
    </div>

    <!-- ================================================================== -->
    <!-- HEADER -->
    <!-- ================================================================== -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-k">K</span>
                <span class="logo-text">OMPITE</span>
            </div>
        </div>
        
        <div class="header-center">
            <nav class="nav">
                <a href="#" class="nav-link active" data-view="lobby">Lobby</a>
                <a href="#" class="nav-link" data-view="games">Juegos</a>
                <a href="#" class="nav-link" data-view="history">Historial</a>
                <a href="#" class="nav-link" data-view="wallet">Wallet</a>
            </nav>
        </div>
        
        <div class="header-right">
            <!-- Balance de LKoins -->
            <div class="balance-display">
                <span class="balance-icon">‚óÜ</span>
                <span class="balance-amount" id="user-balance">0.00</span>
                <span class="balance-currency">LK</span>
            </div>
            
            <!-- Estado de conexi√≥n -->
            <div class="connection-status" id="connection-status">
                <span class="status-dot"></span>
                <span class="status-text">Conectando</span>
            </div>
            
            <!-- Perfil -->
            <div class="user-profile" id="user-profile">
                <div class="avatar">
                    <span>?</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ================================================================== -->
    <!-- CONTENIDO PRINCIPAL -->
    <!-- ================================================================== -->
    <main class="main-content">
        <!-- ============================================================ -->
        <!-- VISTA: LOBBY -->
        <!-- ============================================================ -->
        <section id="view-lobby" class="view active">
            <div class="lobby-container">
                <div class="lobby-header">
                    <h1>Arena de Competencia</h1>
                    <p class="subtitle">Elige tu juego y demuestra tu habilidad</p>
                </div>
                
                <div class="games-grid" id="games-grid">
                    <!-- Los juegos se cargan din√°micamente -->
                </div>
                
                <!-- Stats r√°pidos -->
                <div class="quick-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="stat-active-matches">0</span>
                        <span class="stat-label">Partidas Activas</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="stat-players-online">0</span>
                        <span class="stat-label">Jugadores Online</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="stat-total-prize">0 LK</span>
                        <span class="stat-label">En Premios Hoy</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- VISTA: MATCHMAKING -->
        <!-- ============================================================ -->
        <section id="view-matchmaking" class="view">
            <div class="matchmaking-container">
                <div class="matchmaking-animation">
                    <div class="radar">
                        <div class="radar-sweep"></div>
                    </div>
                </div>
                
                <h2>Buscando Oponente</h2>
                <p class="matchmaking-game" id="matchmaking-game">Cargando...</p>
                <p class="matchmaking-bet" id="matchmaking-bet">Apuesta: 0 LK</p>
                
                <div class="matchmaking-timer">
                    <span id="matchmaking-time">00:00</span>
                </div>
                
                <button class="btn btn-secondary" id="btn-cancel-matchmaking">
                    Cancelar B√∫squeda
                </button>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- VISTA: MATCH (Partida) -->
        <!-- ============================================================ -->
        <section id="view-match" class="view">
            <div class="match-container">
                <!-- Header de partida -->
                <div class="match-header">
                    <div class="player-card player-left">
                        <div class="player-avatar">
                            <span>T√ö</span>
                        </div>
                        <span class="player-name" id="match-player1-name">Jugador 1</span>
                    </div>
                    
                    <div class="match-info">
                        <div class="match-status" id="match-status">PREPARANDO</div>
                        <div class="match-bet">
                            <span class="bet-amount" id="match-bet-amount">0</span>
                            <span class="bet-currency">LK</span>
                        </div>
                    </div>
                    
                    <div class="player-card player-right">
                        <div class="player-avatar">
                            <span>VS</span>
                        </div>
                        <span class="player-name" id="match-player2-name">Oponente</span>
                    </div>
                </div>
                
                <!-- √Årea de juego (se renderiza seg√∫n el tipo de juego) -->
                <div class="game-area" id="game-area">
                    <div class="game-placeholder">
                        <p>El juego se cargar√° aqu√≠</p>
                    </div>
                </div>
                
                <!-- Footer de partida -->
                <div class="match-footer">
                    <div class="connection-indicator">
                        <span class="ping-label">Ping:</span>
                        <span class="ping-value" id="match-ping">--</span>
                        <span class="ping-unit">ms</span>
                    </div>
                    
                    <div class="match-timer" id="match-timer">--:--</div>
                    
                    <div class="match-actions">
                        <button class="btn btn-icon" id="btn-match-settings" title="Configuraci√≥n">
                            ‚öôÔ∏è
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- VISTA: RESULTADO -->
        <!-- ============================================================ -->
        <section id="view-result" class="view">
            <div class="result-container">
                <div class="result-animation" id="result-animation">
                    <!-- Animaci√≥n de victoria/derrota -->
                </div>
                
                <h1 class="result-title" id="result-title">RESULTADO</h1>
                
                <div class="result-details">
                    <div class="result-prize">
                        <span class="prize-label">Premio:</span>
                        <span class="prize-amount" id="result-prize">+0.00</span>
                        <span class="prize-currency">LK</span>
                    </div>
                    
                    <div class="result-stats">
                        <div class="stat">
                            <span class="stat-label">Duraci√≥n</span>
                            <span class="stat-value" id="result-duration">0:00</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Puntuaci√≥n</span>
                            <span class="stat-value" id="result-score">0 - 0</span>
                        </div>
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-primary" id="btn-play-again">
                        Jugar de Nuevo
                    </button>
                    <button class="btn btn-secondary" id="btn-back-lobby">
                        Volver al Lobby
                    </button>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- VISTA: WALLET -->
        <!-- ============================================================ -->
        <section id="view-wallet" class="view">
            <div class="wallet-container">
                <h1>Mi Wallet</h1>
                
                <div class="wallet-balance-card">
                    <span class="wallet-label">Balance Total</span>
                    <div class="wallet-amount">
                        <span class="amount" id="wallet-balance">0.00</span>
                        <span class="currency">LKoins</span>
                    </div>
                    <div class="wallet-fiat">
                        ‚âà S/ <span id="wallet-fiat">0.00</span>
                    </div>
                </div>
                
                <div class="wallet-actions">
                    <button class="btn btn-gold" id="btn-deposit">
                        <span class="btn-icon">‚Üì</span>
                        Depositar
                    </button>
                    <button class="btn btn-secondary" id="btn-withdraw">
                        <span class="btn-icon">‚Üë</span>
                        Retirar
                    </button>
                </div>
                
                <div class="wallet-transactions">
                    <h3>√öltimas Transacciones</h3>
                    <div class="transaction-list" id="transaction-list">
                        <!-- Se llena din√°micamente -->
                        <div class="empty-state">
                            <p>No hay transacciones recientes</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- VISTA: RETIRO -->
        <!-- ============================================================ -->
        <section id="view-withdraw" class="view">
            <div class="withdraw-container">
                <div class="withdraw-header">
                    <button class="btn-back" id="btn-back-from-withdraw">‚Üê</button>
                    <h1>Retirar LKoins</h1>
                </div>

                <!-- Balance disponible -->
                <div class="withdraw-balance-info">
                    <div class="balance-available">
                        <span class="label">Disponible para retiro:</span>
                        <span class="value gold" id="withdraw-available">0.00 LK</span>
                    </div>
                    <div class="balance-locked" id="balance-locked-section" style="display: none;">
                        <span class="label">En escrow (partidas):</span>
                        <span class="value cyan" id="withdraw-locked">0.00 LK</span>
                    </div>
                </div>

                <!-- Informaci√≥n de retiro m√≠nimo -->
                <div class="withdraw-rules">
                    <div class="rule">
                        <span class="rule-icon">‚ö°</span>
                        <span class="rule-text">Retiro m√≠nimo: <strong>5 LKoins (S/ 5.00)</strong></span>
                    </div>
                    <div class="rule">
                        <span class="rule-icon">üïê</span>
                        <span class="rule-text">Tiempo de procesamiento: hasta 24 horas</span>
                    </div>
                    <div class="rule">
                        <span class="rule-icon">üì±</span>
                        <span class="rule-text">Se env√≠a a tu Yape/Plin registrado</span>
                    </div>
                </div>

                <!-- Formulario de retiro -->
                <form class="withdraw-form" id="withdraw-form">
                    <div class="form-group">
                        <label for="withdraw-amount">Monto a retirar (LK)</label>
                        <div class="input-with-max">
                            <input type="number" id="withdraw-amount" step="0.01" min="5" required 
                                   placeholder="5.00">
                            <button type="button" class="btn-max" id="btn-withdraw-max">MAX</button>
                        </div>
                        <span class="form-hint">M√≠nimo 5 LK | Recibir√°s: S/ <span id="withdraw-fiat-preview">0.00</span></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="withdraw-method">M√©todo de retiro</label>
                        <select id="withdraw-method" required>
                            <option value="">Selecciona un m√©todo</option>
                            <option value="YAPE">Yape</option>
                            <option value="PLIN">Plin</option>
                            <option value="BANK_TRANSFER">Transferencia Bancaria</option>
                        </select>
                    </div>

                    <div class="form-group" id="withdraw-phone-group">
                        <label for="withdraw-phone">N√∫mero Yape/Plin</label>
                        <input type="tel" id="withdraw-phone" placeholder="999 888 777" 
                               pattern="[0-9]{9}" maxlength="9">
                        <span class="form-hint">9 d√≠gitos sin espacios</span>
                    </div>

                    <div class="form-group" id="withdraw-bank-group" style="display: none;">
                        <label for="withdraw-cci">N√∫mero de cuenta (CCI)</label>
                        <input type="text" id="withdraw-cci" placeholder="20 d√≠gitos" 
                               pattern="[0-9]{20}" maxlength="20">
                        <span class="form-hint">C√≥digo de Cuenta Interbancario (20 d√≠gitos)</span>
                    </div>

                    <div class="withdraw-summary">
                        <div class="summary-row">
                            <span>Monto a retirar:</span>
                            <span class="value" id="summary-withdraw-amount">0.00 LK</span>
                        </div>
                        <div class="summary-row">
                            <span>Recibir√°s:</span>
                            <span class="value gold" id="summary-withdraw-fiat">S/ 0.00</span>
                        </div>
                        <div class="summary-row small">
                            <span>Tu nuevo balance ser√°:</span>
                            <span class="value" id="summary-new-balance">0.00 LK</span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-gold btn-full" id="btn-submit-withdraw" disabled>
                        Solicitar Retiro
                    </button>
                </form>

                <!-- Estado: Procesando -->
                <div class="withdraw-processing hidden" id="withdraw-processing">
                    <div class="processing-animation">
                        <div class="spinner"></div>
                    </div>
                    <h2>Procesando solicitud...</h2>
                    <p>Tu saldo quedar√° en escrow hasta que se complete el retiro</p>
                </div>

                <!-- Estado: √âxito -->
                <div class="withdraw-success hidden" id="withdraw-success">
                    <div class="success-icon">‚úì</div>
                    <h2>¬°Solicitud Enviada!</h2>
                    <p>Tu retiro ser√° procesado en las pr√≥ximas horas.</p>
                    <div class="ticket-info">
                        <span class="ticket-label">Ticket:</span>
                        <span class="ticket-number" id="withdraw-ticket-number">#WD-000000</span>
                    </div>
                    <div class="escrow-notice">
                        <span class="escrow-icon">üîí</span>
                        <span class="escrow-text">
                            Tu saldo de <strong id="escrow-amount">0.00 LK</strong> est√° en ESCROW hasta la confirmaci√≥n
                        </span>
                    </div>
                    <button class="btn btn-primary" id="btn-withdraw-done">
                        Volver al Wallet
                    </button>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- VISTA: DEP√ìSITO (Con esc√°ner OCR) -->
        <!-- ============================================================ -->
        <section id="view-deposit" class="view">
            <div class="deposit-container">
                <div class="deposit-header">
                    <button class="btn-back" id="btn-back-from-deposit">‚Üê</button>
                    <h1>Depositar LKoins</h1>
                </div>

                <!-- Info de cuenta destino -->
                <div class="deposit-account-info">
                    <h3 class="accounts-title">Env√≠a tu pago a cualquiera de estas cuentas:</h3>
                    
                    <!-- Titular verificado -->
                    <div class="account-holder">
                        <span class="holder-label">Titular Verificado:</span>
                        <span class="holder-name">Yordy Jes√∫s Rojas Baldeon</span>
                    </div>
                    
                    <!-- Yape -->
                    <div class="payment-method yape">
                        <div class="method-header">
                            <span class="provider-icon">üì±</span>
                            <span class="provider-name">Yape</span>
                        </div>
                        <div class="account-number">
                            <span class="number">995 665 397</span>
                            <button class="btn-copy-number" data-copy="995665397" title="Copiar">üìã</button>
                        </div>
                    </div>

                    <!-- Plin -->
                    <div class="payment-method plin">
                        <div class="method-header">
                            <span class="provider-icon">üíö</span>
                            <span class="provider-name">Plin</span>
                        </div>
                        <div class="account-number">
                            <span class="number">960 912 996</span>
                            <button class="btn-copy-number" data-copy="960912996" title="Copiar">üìã</button>
                        </div>
                    </div>

                    <!-- Caja Arequipa -->
                    <div class="payment-method bank">
                        <div class="method-header">
                            <span class="provider-icon">üè¶</span>
                            <span class="provider-name">Caja Arequipa (CCI)</span>
                        </div>
                        <div class="account-number cci">
                            <span class="number">803 127 005315 52 100105</span>
                            <button class="btn-copy-number" data-copy="80312700531552100105" title="Copiar">üìã</button>
                        </div>
                    </div>

                    <p class="account-hint">
                        <span class="hint-icon">‚ö°</span>
                        Despu√©s de enviar, sube la captura del comprobante para validaci√≥n autom√°tica
                    </p>
                </div>

                <!-- √Årea de escaneo -->
                <div class="scanner-area" id="scanner-area">
                    <div class="scanner-dropzone" id="scanner-dropzone">
                        <input type="file" id="receipt-input" accept="image/*" hidden>
                        
                        <!-- Estado: Esperando archivo -->
                        <div class="scanner-state state-idle" id="scanner-idle">
                            <div class="scanner-icon">üì∑</div>
                            <p class="scanner-title">Sube tu comprobante</p>
                            <p class="scanner-subtitle">Arrastra una imagen o haz clic para seleccionar</p>
                            <button class="btn btn-cyan" id="btn-select-image">
                                Seleccionar Imagen
                            </button>
                        </div>

                        <!-- Estado: Escaneando -->
                        <div class="scanner-state state-scanning hidden" id="scanner-scanning">
                            <div class="scanner-animation">
                                <div class="scanner-frame">
                                    <img id="scanner-preview" src="" alt="Preview">
                                    <div class="scan-line"></div>
                                </div>
                                <div class="scanner-pulse"></div>
                            </div>
                            <p class="scanner-title">Analizando comprobante...</p>
                            <div class="scanner-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <span class="progress-text">Detectando proveedor...</span>
                            </div>
                        </div>

                        <!-- Estado: Resultado exitoso -->
                        <div class="scanner-state state-success hidden" id="scanner-success">
                            <div class="scanner-result-icon success">‚úì</div>
                            <p class="scanner-title">¬°Comprobante detectado!</p>
                            <div class="scanner-extracted-data" id="scanner-extracted">
                                <!-- Se llena din√°micamente -->
                            </div>
                        </div>

                        <!-- Estado: Requiere revisi√≥n -->
                        <div class="scanner-state state-warning hidden" id="scanner-warning">
                            <div class="scanner-result-icon warning">‚ö†</div>
                            <p class="scanner-title" id="scanner-warning-title">Atenci√≥n</p>
                            <p class="scanner-warning-msg" id="scanner-warning-msg"></p>
                            <button class="btn btn-secondary" id="btn-rescan">
                                Intentar de nuevo
                            </button>
                        </div>

                        <!-- Estado: Error -->
                        <div class="scanner-state state-error hidden" id="scanner-error">
                            <div class="scanner-result-icon error">‚úó</div>
                            <p class="scanner-title">No se pudo procesar</p>
                            <p class="scanner-error-msg" id="scanner-error-msg"></p>
                            <button class="btn btn-secondary" id="btn-retry-scan">
                                Intentar de nuevo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Formulario de confirmaci√≥n -->
                <form class="deposit-form hidden" id="deposit-form">
                    <div class="form-group">
                        <label for="deposit-amount">Monto (S/)</label>
                        <input type="number" id="deposit-amount" step="0.01" min="1" required 
                               placeholder="50.00">
                        <span class="form-hint">1 PEN = 1 LKoin</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="deposit-reference">Nro. de Operaci√≥n</label>
                        <input type="text" id="deposit-reference" required
                               placeholder="Ej: 12345678">
                    </div>

                    <div class="form-group">
                        <label for="deposit-provider">Proveedor</label>
                        <select id="deposit-provider">
                            <option value="YAPE">Yape</option>
                            <option value="PLIN">Plin</option>
                            <option value="YAPE_TO_PLIN">Yape ‚Üí Plin</option>
                            <option value="BCP">BCP</option>
                            <option value="BBVA">BBVA</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Comprobante</label>
                        <div class="receipt-preview" id="receipt-preview">
                            <img src="" alt="Comprobante" id="receipt-preview-img">
                            <button type="button" class="btn-change-receipt" id="btn-change-receipt">
                                Cambiar
                            </button>
                        </div>
                    </div>

                    <div class="deposit-summary">
                        <div class="summary-row">
                            <span>Recibir√°s:</span>
                            <span class="summary-value gold" id="deposit-lkoins">0.00 LKC</span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-gold btn-full" id="btn-submit-deposit">
                        Solicitar Dep√≥sito
                    </button>
                </form>

                <!-- Mensaje de √©xito -->
                <div class="deposit-success hidden" id="deposit-success">
                    <div class="success-icon">‚úì</div>
                    <h2>¬°Solicitud Enviada!</h2>
                    <p>Tu dep√≥sito ser√° verificado en menos de 5 minutos.</p>
                    <p class="success-ref">Referencia: <span id="success-ref-number"></span></p>
                    <button class="btn btn-primary" id="btn-deposit-done">
                        Volver al Wallet
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- ================================================================== -->
    <!-- MODAL DE BET (Selecci√≥n de Apuesta) -->
    <!-- ================================================================== -->
    <div id="modal-bet" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurar Partida</h2>
                <button class="modal-close" id="modal-bet-close">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="game-preview" id="modal-game-preview">
                    <div class="game-icon">üéÆ</div>
                    <h3 class="game-name" id="modal-game-name">Juego</h3>
                </div>
                
                <div class="bet-selector">
                    <label>Monto de Apuesta</label>
                    <div class="bet-options" id="bet-options">
                        <button class="bet-option" data-amount="1">1 LK</button>
                        <button class="bet-option" data-amount="5">5 LK</button>
                        <button class="bet-option" data-amount="10">10 LK</button>
                        <button class="bet-option active" data-amount="20">20 LK</button>
                        <button class="bet-option" data-amount="50">50 LK</button>
                        <button class="bet-option" data-amount="100">100 LK</button>
                    </div>
                    
                    <div class="bet-custom">
                        <label for="bet-custom-input">O ingresa un monto:</label>
                        <div class="input-group">
                            <input type="number" id="bet-custom-input" min="1" placeholder="0">
                            <span class="input-suffix">LK</span>
                        </div>
                    </div>
                </div>
                
                <div class="bet-summary">
                    <div class="summary-row">
                        <span>Tu apuesta:</span>
                        <span id="bet-your-amount">20 LK</span>
                    </div>
                    <div class="summary-row">
                        <span>Premio potencial:</span>
                        <span class="prize" id="bet-potential-prize">38 LK</span>
                    </div>
                    <div class="summary-row fee">
                        <span>Comisi√≥n (5%):</span>
                        <span id="bet-fee">2 LK</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary btn-lg" id="btn-start-matchmaking">
                    Buscar Oponente
                </button>
            </div>
        </div>
    </div>

    <!-- ================================================================== -->
    <!-- TOAST NOTIFICATIONS -->
    <!-- ================================================================== -->
    <div id="toast-container" class="toast-container"></div>

    <!-- ================================================================== -->
    <!-- SCRIPTS -->
    <!-- ================================================================== -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="js/games/ludo.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
